<html>
<head>
<title>Create User</title>
<script src="/system/sling.js"></script>
<script type="text/javascript" src="/etc/clientlibs/webrequest.js"></script>
</head>
<body>
<h3>Create New User</h3>
<form method="POST" action="/system/userManager/user.create.html">
Username<input type="text" name=":name" onChange="document.getElementById('uid').value = this.value;" /><br/>
Password:<input type="password" name="pwd" /><br/>
Confirm:<input type="password" name="pwdConfirm" /><br/>
<input type="hidden" name="uid" id="uid" />
<input type="hidden" name="sling:resourceType" value="users/edit" />
<input type="submit" value="Create User" />
</form>
<h3>Existing Users</h3>
<ul id="userlist">
</ul>
<script type="text/javascript">
    document.body.onload = function() {
        var req = new WebRequest("GET","/system/userManager/user.1.json");

        req.response.then(resp => {
            var usersObj = JSON.parse(resp.body);

            var validUsers = Object.keys(usersObj).filter(x => x != 'anonymous').forEach(thisUser => {
                var listItem = document.createElement('li');
                var link = document.createElement('a');
                link.href = usersObj[thisUser].path + ".html";
                link.innerText = thisUser;
                listItem.appendChild(link);
                document.getElementById('userlist').appendChild(listItem);
            });
        });
    };
</script>
</body>
</html>

